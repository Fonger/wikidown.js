<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
  <link rel="stylesheet" href="../epub.css" type="text/css" />
</head>
<body>
<div id="header_wrap">
   <h1><a href="index.html">少年科技人雜誌</a></h1>
</div>
<div id="content">
<div id="TOC">
<ul>
<li><a href="#將-wikidown-推上-heroku-成為雲端系統">將 Wikidown 推上 heroku 成為雲端系統</a></li>
</ul>
</div>
<h2 id="將-wikidown-推上-heroku-成為雲端系統"><a href="#將-wikidown-推上-heroku-成為雲端系統">將 Wikidown 推上 heroku 成為雲端系統</a></h2>
<p>如果您已經有個專案，並且將檔案都加入 git 裡面了，就像下列文章中所做的事情一樣，那麼恭喜您，您已經具備了將檔案上傳到 heroku 上的大部分基礎，只要在補上幾個動作就行了。</p>
<ul>
<li><a href="pmag201503:focus3">[將 Wikidown 推上 github 成為開源靜態網站]</a></li>
</ul>
<h3 id="申請帳號並安裝軟體"><a href="#申請帳號並安裝軟體">申請帳號並安裝軟體</a></h3>
<p>要將您的 node.js 系統「安裝」到 heroku 平台上，必須依靠 git 工具，還有一個 heroku 所出版的軟體，稱為 Heroku Toolbelt for Windows ，您可以到下列網址中下載這個軟體。</p>
<ul>
<li><a href="https://devcenter.heroku.com/articles/getting-started-with-nodejs#set-up">https://devcenter.heroku.com/articles/getting-started-with-nodejs#set-up</a></li>
</ul>
<p>安裝好之後，您必須上 heroku 網站 <a href="https://www.heroku.com/">https://www.heroku.com/</a> 上申請帳號密碼，然後用 <code>heroku create &lt;project&gt;</code> 這個指令在 heroku 上創建一個專案，接著用 <code>git push heroku master</code> 將您的 master 版本推到 heroku 上，然後用 <code>heroku open</code> 指令打開該專案的網址，就可以看到您的專案已經在 heroku 上面運行了。</p>
<pre><code>heroku create wikidown
git push heroku master
heroku open</code></pre>
<p>當然、這是在您的專案與程式完全正確的情況之下才行的，不過、到底要上傳到 heroku 上的專案要如何才算是正確的呢？除了您可以用 node.js 將該專案跑起來之外，還必須加上一些設定。</p>
<p>第一個設定是您必須在專案的根目錄中加入一個名為 Procfile 的檔案，這個檔案用來告訴 heroku 執行您專案的指令。</p>
<p>檔案：Procfile</p>
<pre><code>web: node wikiServer.js</code></pre>
<p>還有您必須要寫好 node.js 需要的 package.json 檔案，以下是 wikidown 的 package.json 檔案之內容，這樣 heroku 才知道要為你準備好哪些版本的套件。</p>
<p>檔案： package.json</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript">{
  <span class="st">&quot;name&quot;</span>: <span class="st">&quot;wikidown&quot;</span>,
  <span class="st">&quot;version&quot;</span>: <span class="st">&quot;1.0.0&quot;</span>,
  <span class="st">&quot;description&quot;</span>: <span class="st">&quot;Wikidown = wiki+markdown&quot;</span>,
  <span class="st">&quot;main&quot;</span>: <span class="st">&quot;wikiServer.js&quot;</span>,
  <span class="st">&quot;dependencies&quot;</span>: {
    <span class="st">&quot;serve-index&quot;</span>: <span class="st">&quot;~1.6.0&quot;</span>,
    <span class="st">&quot;body-parser&quot;</span>: <span class="st">&quot;^1.10.1&quot;</span>,
    <span class="st">&quot;cookie-parser&quot;</span>: <span class="st">&quot;1.3.3&quot;</span>,
    <span class="st">&quot;express-session&quot;</span>:<span class="st">&quot;1.10.1&quot;</span>,
    <span class="st">&quot;express&quot;</span>: <span class="st">&quot;4.11.0&quot;</span>
  },
  <span class="st">&quot;devDependencies&quot;</span>: {},
  <span class="st">&quot;scripts&quot;</span>: {
    <span class="st">&quot;test&quot;</span>: <span class="st">&quot;echo </span><span class="ch">\&quot;</span><span class="st">Error: no test specified</span><span class="ch">\&quot;</span><span class="st"> &amp;&amp; exit 1&quot;</span>,
    <span class="st">&quot;start&quot;</span>: <span class="st">&quot;node wikiServer.js&quot;</span>
  },
  <span class="st">&quot;repository&quot;</span>: {
    <span class="st">&quot;type&quot;</span>: <span class="st">&quot;git&quot;</span>,
    <span class="st">&quot;url&quot;</span>: <span class="st">&quot;https://github.com/ccckmit/markdown1.git&quot;</span>
  },
  <span class="st">&quot;keywords&quot;</span>: [
    <span class="st">&quot;wiki&quot;</span>,
    <span class="st">&quot;markdown&quot;</span>,
    <span class="st">&quot;blog&quot;</span>
  ],
  <span class="st">&quot;author&quot;</span>: <span class="st">&quot;ccckmit&quot;</span>,
  <span class="st">&quot;bugs&quot;</span>: {
    <span class="st">&quot;url&quot;</span>: <span class="st">&quot;https://github.com/ccckmit/markdown1/issues&quot;</span>
  },
  <span class="st">&quot;homepage&quot;</span>: <span class="st">&quot;https://github.com/ccckmit/wikidown1&quot;</span>
}</code></pre>
<p>還有很重要的一點是，您的 node.js 伺服端程式，必須使用 process.env.PORT 這個環境變數來開 port ，否則將會因為開錯 port 而無法運作。以下是 wikidown 專案打開 port 部份的程式碼：</p>
<pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> port = <span class="ot">process</span>.<span class="ot">env</span>.<span class="fu">PORT</span> || <span class="dv">3000</span>; <span class="co">// process.env.PORT for Heroku</span>
<span class="ot">app</span>.<span class="fu">listen</span>(port);</code></pre>
<p>如果您想在上傳之前先驗證您的系統是否能在 heroku 上正常運行，可以用 <code>foreman start</code> 這個指令進行測試，該指令會模擬 heroku 的環境來執行您的專案。執行完該指令後請開啟 <code>http://localhost:5000</code> 這個 網址來檢視您的系統。</p>
<p>如果一切沒問題，就可以按照本文一開頭的指示，用下列指令將系統上傳到 heroku 上運行。</p>
<pre><code>heroku create wikidown
git push heroku master
heroku open</code></pre>
<p>假如還是有問題的話，建議您參考 heroku 網站上針對 node.js 寫的 <a href="https://devcenter.heroku.com/articles/getting-started-with-nodejs">getting-started-with-nodejs</a> 這篇文章，並且一步一步的照做一遍，應該就會瞭解如何將專案放上 heroku 平台的方法了。</p>
<h3 id="後記"><a href="#後記">後記</a></h3>
<p>以下是筆者將 wikidown.js 系統上傳到 heroku 上的教學錄影，對於想發布專案到 heroku 上的人而言，應該會很有參考價值。</p>
<ul>
<li><a href="http://youtu.be/JpkTt9qAvXA">YouTube影片：如何將 node.js 的網站發布到 heroku 雲貒平台上 -- 以 wikidown.js 的發布為例</a></li>
</ul>
</div>
<div id="footer">
<a href="https://www.facebook.com/groups/youngmaker.magazine/">少年科技人雜誌</a> ，採用 <a href="http://creativecommons.org/licenses/by-sa/3.0/tw/ ">創作共用：姓名標示、相同方式分享</a> 授權，歡迎加入 <a href="https://www.facebook.com/groups/youngmaker.magazine/">雜誌社團</a>
</div>
</body>
</html>
